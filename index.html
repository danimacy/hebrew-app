<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Word Trainer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 16px;
    }
    .app {
      width: 100%;
      max-width: 480px;
      background: #020617;
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.5);
      border: 1px solid #1f2937;
    }
    h1 {
      margin: 0 0 12px;
      font-size: 22px;
      text-align: center;
    }
    .subtitle {
      font-size: 12px;
      color: #9ca3af;
      text-align: center;
      margin-bottom: 12px;
    }
    .tabs {
      display: flex;
      margin-bottom: 12px;
      border-radius: 999px;
      background: #020617;
      border: 1px solid #111827;
      padding: 2px;
    }
    .tab {
      flex: 1;
      text-align: center;
      padding: 8px 4px;
      font-size: 13px;
      border-radius: 999px;
      border: none;
      background: transparent;
      color: #9ca3af;
      cursor: pointer;
    }
    .tab.active {
      background: #1d4ed8;
      color: #f9fafb;
      font-weight: 600;
    }
    .section { display: none; }
    .section.active { display: block; }

    textarea {
      width: 100%;
      min-height: 120px;
      border-radius: 12px;
      border: 1px solid #111827;
      background: #020617;
      color: #e5e7eb;
      padding: 8px;
      font-size: 13px;
      resize: vertical;
    }
    textarea::placeholder { color: #6b7280; }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 13px;
      cursor: pointer;
      margin-top: 8px;
      margin-right: 6px;
    }
    .btn-primary {
      background: #1d4ed8;
      color: #f9fafb;
    }
    .btn-secondary {
      background: #111827;
      color: #e5e7eb;
    }
    .btn-danger {
      background: #b91c1c;
      color: #fee2e2;
    }

    .hint {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 6px;
      line-height: 1.4;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 12px;
    }
    th, td {
      border-bottom: 1px solid #111827;
      padding: 4px 2px;
    }
    th {
      text-align: left;
      color: #9ca3af;
      font-weight: 500;
    }

    .small {
      font-size: 12px;
      color: #9ca3af;
      margin-top: 6px;
    }

    .flashcard {
      margin-top: 10px;
      padding: 20px;
      border-radius: 16px;
      border: 1px solid #1f2937;
      background: radial-gradient(circle at top, #1f2937, #020617);
      text-align: center;
      min-height: 120px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .flash-main {
      font-size: 24px;
      margin-bottom: 8px;
      word-wrap: break-word;
    }
    .flash-sub {
      font-size: 16px;
      color: #9ca3af;
      word-wrap: break-word;
    }
    .flash-controls {
      margin-top: 10px;
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .stats {
      font-size: 12px;
      color: #9ca3af;
      margin-top: 6px;
      text-align: center;
    }

    .quiz-card {
      margin-top: 10px;
      padding: 16px;
      border-radius: 16px;
      border: 1px solid #1f2937;
      background: #020617;
    }
    .quiz-question {
      font-size: 18px;
      margin-bottom: 10px;
      text-align: center;
    }
    .options {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
    }
    .option-btn {
      width: 100%;
      border-radius: 12px;
      padding: 8px;
      border: 1px solid #111827;
      background: #020617;
      color: #e5e7eb;
      font-size: 14px;
      cursor: pointer;
      text-align: left;
    }
    .option-btn.correct {
      background: #14532d;
      border-color: #16a34a;
      color: #bbf7d0;
    }
    .option-btn.wrong {
      background: #7f1d1d;
      border-color: #ef4444;
      color: #fee2e2;
    }
    .quiz-footer {
      margin-top: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      color: #9ca3af;
    }
    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 10px;
      background: #111827;
      color: #e5e7eb;
    }
    .top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    .top-row span {
      font-size: 11px;
      color: #9ca3af;
    }

    /* –∫–∞—Ä—Ç—ã –¥–ª—è –∏–≥—Ä—ã "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è" */
    .match-card {
      background: #020617;
      border: 1px solid #1f2937;
      padding: 10px;
      margin-bottom: 8px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 14px;
    }
    .match-card:hover {
      background: #1f2937;
    }
    .match-card.selected {
      background: #1d4ed8;
      border-color: #2563eb;
      color: #f9fafb;
    }
    .match-card.correct {
      background: #14532d;
      border-color: #16a34a;
      color: #bbf7d0;
    }
    .match-card.wrong {
      background: #7f1d1d;
      border-color: #ef4444;
      color: #fee2e2;
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>Word Trainer</h1>
    <div class="subtitle">–£—á–∏—Ç—å –∏–≤—Ä–∏—Ç (–∏ –Ω–µ —Ç–æ–ª—å–∫–æ) —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏</div>

    <div class="tabs">
      <button class="tab active" data-target="list">–°–ø–∏—Å–æ–∫ —Å–ª–æ–≤</button>
      <button class="tab" data-target="flashcards">–§–ª–µ—à-–∫–∞—Ä—Ç—ã</button>
      <button class="tab" data-target="quiz">–¢–µ—Å—Ç</button>
      <button class="tab" data-target="match">–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è</button>
    </div>

    <!-- –°–ï–ö–¶–ò–Ø: –°–ü–ò–°–û–ö –°–õ–û–í -->
    <div class="section active" id="section-list">
      <div class="top-row">
        <span id="total-words-label">–°–ª–æ–≤: 0</span>
        <button class="btn btn-danger" id="clear-all-btn">–°—Ç–µ—Ä–µ—Ç—å –≤—Å—ë</button>
      </div>
      <textarea id="import-text" placeholder="◊©◊ú◊ï◊ù - –ø—Ä–∏–≤–µ—Ç
◊ë◊ô◊™ - –¥–æ–º
◊û◊ô◊ù - –≤–æ–¥–∞"></textarea>
      <button class="btn btn-primary" id="import-btn">–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
      <div class="hint">
        –ö–∞–∂–¥—ã–π —Ä—è–¥ ‚Äî –Ω–æ–≤–æ–µ —Å–ª–æ–≤–æ.<br>
        –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å: <b>-</b> –∏–ª–∏ <b>;</b> –∏–ª–∏ —Ç–∞–±—É–ª—è—Ü–∏—è.<br>
        –°–ª–µ–≤–∞ ‚Äî –∏–≤—Ä–∏—Ç, —Å–ø—Ä–∞–≤–∞ ‚Äî –ø–µ—Ä–µ–≤–æ–¥.
      </div>

      <table id="word-table">
        <thead>
          <tr>
            <th>#</th>
            <th>–ò–≤—Ä–∏—Ç</th>
            <th>–ü–µ—Ä–µ–≤–æ–¥</th>
          </tr>
        </thead>
        <tbody id="word-tbody"></tbody>
      </table>
    </div>

    <!-- –°–ï–ö–¶–ò–Ø: –§–õ–ï–®–ö–ê–†–¢–´ -->
    <div class="section" id="section-flashcards">
      <div class="small">
        –ù–∞–∂–∏–º–∞–π ¬´–ü–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥¬ª, –∑–∞—Ç–µ–º –æ—Ç–º–µ—á–∞–π ¬´–ó–Ω–∞—é / –ù–µ –∑–Ω–∞—é¬ª.  
        –ö–∞—Ä—Ç–æ—á–∫–∏ –∏–¥—É—Ç –≤ —Å–ª—É—á–∞–π–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ.
      </div>
      <div class="flashcard" id="flashcard">
        <div class="flash-main" id="flash-front">–ù–µ—Ç —Å–ª–æ–≤ üôÉ</div>
        <div class="flash-sub" id="flash-back">–î–æ–±–∞–≤—å —Å–ª–æ–≤–∞ –≤–æ –≤–∫–ª–∞–¥–∫–µ ¬´–°–ø–∏—Å–æ–∫ —Å–ª–æ–≤¬ª</div>
      </div>
      <div class="flash-controls">
        <button class="btn btn-secondary" id="flash-toggle-btn">–ü–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥</button>
        <button class="btn btn-primary" id="flash-next-btn">–°–ª–µ–¥—É—é—â–∞—è</button>
        <button class="btn btn-secondary" id="flash-know-btn">–ó–Ω–∞—é ‚úÖ</button>
        <button class="btn btn-secondary" id="flash-dont-know-btn">–ù–µ –∑–Ω–∞—é ‚ùå</button>
      </div>
      <div class="stats" id="flash-stats"></div>
    </div>

    <!-- –°–ï–ö–¶–ò–Ø: –¢–ï–°–¢ -->
    <div class="section" id="section-quiz">
      <div class="small">
        –í—ã–±–∏—Ä–∞–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥. –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ ‚Äî —Å–ª—É—á–∞–π–Ω—ã–µ —Å–ª–æ–≤–∞ –∏–∑ —Ç–≤–æ–µ–≥–æ —Å–ø–∏—Å–∫–∞.
      </div>
      <div class="quiz-card" id="quiz-card">
        <div class="quiz-question" id="quiz-question">–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–ª–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∞.</div>
        <div class="options" id="quiz-options"></div>
        <div class="quiz-footer">
          <span id="quiz-progress" class="badge">0 / 0</span>
          <button class="btn btn-secondary" id="next-question-btn">–î–∞–ª—å—à–µ</button>
        </div>
      </div>
    </div>

    <!-- –°–ï–ö–¶–ò–Ø: –°–û–û–¢–í–ï–¢–°–¢–í–ò–Ø -->
    <div class="section" id="section-match">
      <div class="small">
        –°–æ–µ–¥–∏–Ω–∏ —Å–ª–æ–≤–∞ –ø–æ —Å–º—ã—Å–ª—É. –ù–∞–∂–º–∏ –æ–¥–Ω–æ —Å–ª–æ–≤–æ —Å–ª–µ–≤–∞ –∏ –æ–¥–Ω–æ —Å–ø—Ä–∞–≤–∞.
      </div>

      <div id="match-area" style="margin-top: 14px;">
        <div style="display:flex; gap:16px; justify-content:space-between;">
          <div style="flex:1;">
            <h3 style="font-size:14px; margin:0 0 6px; color:#9ca3af;">–ò–≤—Ä–∏—Ç</h3>
            <div id="match-left"></div>
          </div>

          <div style="flex:1;">
            <h3 style="font-size:14px; margin:0 0 6px; color:#9ca3af;">–†—É—Å—Å–∫–∏–π</h3>
            <div id="match-right"></div>
          </div>
        </div>
      </div>

      <button class="btn btn-primary" id="match-new-btn" style="margin-top:16px;">
        –ù–æ–≤–∞—è –∏–≥—Ä–∞
      </button>
    </div>
  </div>

  <script>
    const STORAGE_KEY = "word_trainer_deck_v1";

    let cards = []; // {front: "...", back: "..."}
    let flashIndex = 0;
    let flashShowBack = false;
    let flashStats = { known: 0, unknown: 0, seen: 0 };

    let quizCurrent = null; // {questionCard, options[], correctIndex}
    let quizSeen = 0;
    let quizCorrect = 0;
    let quizLocked = false;

    // --- MATCHING GAME STATE ---
    let matchPairs = [];
    let matchLeft = [];
    let matchRight = [];
    let matchSelectedLeft = null;
    let matchSelectedRight = null;

    // --- STORAGE ---
    function loadFromStorage() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) {
          cards = [];
          return;
        }
        const parsed = JSON.parse(raw);
        if (Array.isArray(parsed)) {
          cards = parsed.filter(
            c => c && typeof c.front === "string" && typeof c.back === "string"
          );
        } else {
          cards = [];
        }
      } catch (e) {
        cards = [];
      }
    }

    function saveToStorage() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(cards));
    }

    // --- UI HELPERS ---
    function setActiveSection(id) {
      document.querySelectorAll(".section").forEach(sec => {
        sec.classList.toggle("active", sec.id === "section-" + id);
      });
      document.querySelectorAll(".tab").forEach(tab => {
        tab.classList.toggle("active", tab.dataset.target === id);
      });

      if (id === "match") {
        startMatchGame();
      }
    }

    // --- LIST SECTION ---
    function renderTable() {
      const tbody = document.getElementById("word-tbody");
      tbody.innerHTML = "";
      cards.forEach((c, i) => {
        const tr = document.createElement("tr");
        const tdIndex = document.createElement("td");
        const tdFront = document.createElement("td");
        const tdBack = document.createElement("td");
        tdIndex.textContent = i + 1;
        tdFront.textContent = c.front;
        tdBack.textContent = c.back;
        tr.appendChild(tdIndex);
        tr.appendChild(tdFront);
        tr.appendChild(tdBack);
        tbody.appendChild(tr);
      });
      document.getElementById("total-words-label").textContent =
        "–°–ª–æ–≤: " + cards.length;
    }

    function parseImportText(text) {
      const lines = text.split(/\r?\n/);
      const newCards = [];
      for (let line of lines) {
        line = line.trim();
        if (!line) continue;
        // —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å: —Ç–∞–±, ; –∏–ª–∏ -
        let parts = line.split(/\t|;| - | -|- /);
        if (parts.length < 2) {
          parts = line.split(" ");
          if (parts.length >= 2) {
            const front = parts[0];
            const back = parts.slice(1).join(" ");
            newCards.push({ front: front.trim(), back: back.trim() });
          }
          continue;
        }
        const front = parts[0].trim();
        const back = parts.slice(1).join(" ").trim();
        if (front && back) {
          newCards.push({ front, back });
        }
      }
      return newCards;
    }

    function handleImport() {
      const text = document.getElementById("import-text").value;
      const imported = parseImportText(text);
      if (imported.length === 0) {
        alert("–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –Ω–æ–≤—ã–µ —Å–ª–æ–≤–∞. –ü—Ä–æ–≤–µ—Ä—å —Ñ–æ—Ä–º–∞—Ç.");
        return;
      }
      cards = cards.concat(imported);
      saveToStorage();
      renderTable();
      resetFlash();
      resetQuiz();
      startMatchGame();
      alert("–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ —Å–ª–æ–≤: " + imported.length);
    }

    function handleClearAll() {
      if (!confirm("–¢–æ—á–Ω–æ —Å—Ç–µ—Ä–µ—Ç—å –≤—Å–µ —Å–ª–æ–≤–∞?")) return;
      cards = [];
      saveToStorage();
      renderTable();
      resetFlash();
      resetQuiz();
      startMatchGame();
    }

    // --- FLASHCARDS ---
    function resetFlash() {
      flashIndex = 0;
      flashShowBack = false;
      flashStats = { known: 0, unknown: 0, seen: 0 };
      updateFlashcard();
      updateFlashStats();
    }

    function randomIndex(max) {
      return Math.floor(Math.random() * max);
    }

    function pickFlashIndex() {
      if (cards.length === 0) {
        flashIndex = 0;
        return;
      }
      flashIndex = randomIndex(cards.length);
    }

    function updateFlashcard() {
      const frontEl = document.getElementById("flash-front");
      const backEl = document.getElementById("flash-back");
      const toggleBtn = document.getElementById("flash-toggle-btn");

      if (cards.length === 0) {
        frontEl.textContent = "–ù–µ—Ç —Å–ª–æ–≤ üôÉ";
        backEl.textContent = "–î–æ–±–∞–≤—å —Å–ª–æ–≤–∞ –≤–æ –≤–∫–ª–∞–¥–∫–µ ¬´–°–ø–∏—Å–æ–∫ —Å–ª–æ–≤¬ª";
        toggleBtn.disabled = true;
        document.getElementById("flash-next-btn").disabled = true;
        document.getElementById("flash-know-btn").disabled = true;
        document.getElementById("flash-dont-know-btn").disabled = true;
        return;
      }

      toggleBtn.disabled = false;
      document.getElementById("flash-next-btn").disabled = false;
      document.getElementById("flash-know-btn").disabled = false;
      document.getElementById("flash-dont-know-btn").disabled = false;

      const card = cards[flashIndex];
      if (!flashShowBack) {
        frontEl.textContent = card.front;
        backEl.textContent = "¬∑¬∑¬∑";
        toggleBtn.textContent = "–ü–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥";
      } else {
        frontEl.textContent = card.front;
        backEl.textContent = card.back;
        toggleBtn.textContent = "–°–∫—Ä—ã—Ç—å –ø–µ—Ä–µ–≤–æ–¥";
      }
    }

    function updateFlashStats() {
      const s = flashStats;
      const el = document.getElementById("flash-stats");
      if (cards.length === 0) {
        el.textContent = "";
        return;
      }
      el.textContent =
        `–ü–æ–∫–∞–∑–∞–Ω–æ: ${s.seen} | –ó–Ω–∞—é: ${s.known} | –ù–µ –∑–Ω–∞—é: ${s.unknown}`;
    }

    function flashToggle() {
      if (cards.length === 0) return;
      flashShowBack = !flashShowBack;
      updateFlashcard();
    }

    function flashNext(mark) {
      if (cards.length === 0) return;
      flashStats.seen++;
      if (mark === "known") flashStats.known++;
      if (mark === "unknown") flashStats.unknown++;
      updateFlashStats();

      flashShowBack = false;
      pickFlashIndex();
      updateFlashcard();
    }

    // --- QUIZ ---
    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }

    function resetQuiz() {
      quizCurrent = null;
      quizSeen = 0;
      quizCorrect = 0;
      quizLocked = false;
      buildNewQuestion();
    }

    function buildNewQuestion() {
      const questionEl = document.getElementById("quiz-question");
      const optionsEl = document.getElementById("quiz-options");
      const progressEl = document.getElementById("quiz-progress");
      const nextBtn = document.getElementById("next-question-btn");

      optionsEl.innerHTML = "";
      quizLocked = false;

      if (cards.length < 2) {
        questionEl.textContent = "–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 2 —Å–ª–æ–≤–∞ –¥–ª—è —Ç–µ—Å—Ç–∞.";
        nextBtn.disabled = true;
        progressEl.textContent = "0 / 0";
        return;
      }

      nextBtn.disabled = false;

      const qIndex = randomIndex(cards.length);
      const questionCard = cards[qIndex];

      const indices = [];
      for (let i = 0; i < cards.length; i++) {
        if (i !== qIndex) indices.push(i);
      }
      shuffleArray(indices);
      const wrongIndices = indices.slice(0, Math.min(3, indices.length));

      const options = [questionCard.back];
      wrongIndices.forEach(i => options.push(cards[i].back));

      shuffleArray(options);
      const correctIndex = options.indexOf(questionCard.back);

      quizCurrent = { questionCard, options, correctIndex };
      quizSeen++;

      questionEl.textContent = questionCard.front;
      options.forEach((optText, idx) => {
        const btn = document.createElement("button");
        btn.className = "option-btn";
        btn.textContent = optText;
        btn.addEventListener("click", () => handleOptionClick(idx, btn));
        optionsEl.appendChild(btn);
      });

      progressEl.textContent = `${quizCorrect} / ${quizSeen - 1}`;
    }

    function handleOptionClick(idx, btn) {
      if (quizLocked || !quizCurrent) return;
      quizLocked = true;
      const { correctIndex } = quizCurrent;

      const optionButtons = document.querySelectorAll(".option-btn");

      if (idx === correctIndex) {
        quizCorrect++;
      }

      optionButtons.forEach((b, i) => {
        if (i === correctIndex) {
          b.classList.add("correct");
        } else if (i === idx) {
          b.classList.add("wrong");
        }
        b.disabled = true;
      });

      const progressEl = document.getElementById("quiz-progress");
      progressEl.textContent = `${quizCorrect} / ${quizSeen}`;
    }

    function nextQuestion() {
      if (cards.length < 2) return;
      buildNewQuestion();
    }

    // --- MATCHING GAME ---
    function startMatchGame() {
      const areaLeft = document.getElementById("match-left");
      const areaRight = document.getElementById("match-right");
      if (!areaLeft || !areaRight) return;

      areaLeft.innerHTML = "";
      areaRight.innerHTML = "";

      if (cards.length < 5) {
        areaLeft.innerHTML = "<div class='small'>–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 5 —Å–ª–æ–≤.</div>";
        return;
      }

      const shuffled = [...cards];
      shuffleArray(shuffled);
      matchPairs = shuffled.slice(0, 5);

      matchLeft = matchPairs.map((x, i) => ({ index: i, text: x.front }));
      matchRight = matchPairs.map((x, i) => ({ index: i, text: x.back }));

      shuffleArray(matchLeft);
      shuffleArray(matchRight);

      matchSelectedLeft = null;
      matchSelectedRight = null;

      matchLeft.forEach(item => {
        const div = document.createElement("div");
        div.className = "match-card";
        div.textContent = item.text;
        div.dataset.index = item.index;
        div.onclick = () => selectLeft(div);
        areaLeft.appendChild(div);
      });

      matchRight.forEach(item => {
        const div = document.createElement("div");
        div.className = "match-card";
        div.textContent = item.text;
        div.dataset.index = item.index;
        div.onclick = () => selectRight(div);
        areaRight.appendChild(div);
      });
    }

    function selectLeft(el) {
      if (el.classList.contains("correct")) return;

      document.querySelectorAll("#match-left .match-card")
        .forEach(x => x.classList.remove("selected"));
      el.classList.add("selected");
      matchSelectedLeft = el;
      tryMatch();
    }

    function selectRight(el) {
      if (el.classList.contains("correct")) return;

      document.querySelectorAll("#match-right .match-card")
        .forEach(x => x.classList.remove("selected"));
      el.classList.add("selected");
      matchSelectedRight = el;
      tryMatch();
    }

    function tryMatch() {
      if (!matchSelectedLeft || !matchSelectedRight) return;

      const leftIndex = matchSelectedLeft.dataset.index;
      const rightIndex = matchSelectedRight.dataset.index;

      if (leftIndex === rightIndex) {
        matchSelectedLeft.classList.remove("selected");
        matchSelectedRight.classList.remove("selected");

        matchSelectedLeft.classList.add("correct");
        matchSelectedRight.classList.add("correct");

        matchSelectedLeft.onclick = null;
        matchSelectedRight.onclick = null;
      } else {
        matchSelectedLeft.classList.add("wrong");
        matchSelectedRight.classList.add("wrong");

        const l = matchSelectedLeft;
        const r = matchSelectedRight;

        setTimeout(() => {
          l.classList.remove("wrong", "selected");
          r.classList.remove("wrong", "selected");
        }, 600);
      }

      matchSelectedLeft = null;
      matchSelectedRight = null;
    }

    // --- INIT ---
    function initTabs() {
      document.querySelectorAll(".tab").forEach(tab => {
        tab.addEventListener("click", () => {
          setActiveSection(tab.dataset.target);
        });
      });
    }

    function init() {
      loadFromStorage();
      renderTable();
      resetFlash();
      resetQuiz();
      startMatchGame();

      initTabs();

      document.getElementById("import-btn").addEventListener("click", handleImport);
      document.getElementById("clear-all-btn").addEventListener("click", handleClearAll);

      document.getElementById("flash-toggle-btn").addEventListener("click", flashToggle);
      document.getElementById("flash-next-btn").addEventListener("click", () => flashNext());
      document.getElementById("flash-know-btn").addEventListener("click", () => flashNext("known"));
      document.getElementById("flash-dont-know-btn").addEventListener("click", () => flashNext("unknown"));

      document.getElementById("next-question-btn").addEventListener("click", nextQuestion);
      document.getElementById("match-new-btn").addEventListener("click", startMatchGame);
    }

    document.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>